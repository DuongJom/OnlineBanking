{% extends "general/layout.html" %}
{% block title %} OTP Confirmation {% endblock %}

{% block content %}
<div class="bg-gray-100 flex items-center justify-center min-h-screen px-4">
    <div class="bg-white p-8 sm:p-10 rounded-2xl shadow-lg w-full max-w-md">
        <form method="post" action="/confirm-otp">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">Enter OTP</h2>
            <p class="text-center text-sm text-gray-600 mb-6">
                We’ve sent a 6-digit OTP to your email. Please enter it below to continue.
            </p>

            <!-- Countdown -->
            <div class="text-center text-sm text-gray-500 mb-4">
                <p id="countdown">Resend OTP in <span id="time" class="text-red-600">01:00</span></p>
            </div>

            <!-- OTP Inputs -->
            <div class="flex justify-between gap-2 mb-6">
                {% for i in range(1, 7) %}
                <input id="otp{{ i }}" name="otp{{ i }}" type="text" maxlength="1"
                    class="otp-input w-12 h-12 sm:w-14 sm:h-14 text-xl text-center border border-gray-300 rounded-md
                    focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-all duration-150"/>
                {% endfor %}
            </div>

            <!-- Submit -->
            <input type="submit" value="Verify OTP" id="verifyBtn"
                class="w-full py-2 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700
                transition-all disabled:opacity-50 disabled:cursor-not-allowed"/>

        </form>

        <!-- Resend -->
        <div class="mt-6 text-center text-sm text-gray-600">
            Didn’t receive the code?
            <a href="/confirm-otp" class="text-blue-600 hover:underline font-medium">Resend OTP</a>
        </div>
    </div>
</div>

<script>
    let countdownTime = 60;

    function updateCountdown() {
        const minutes = Math.floor(countdownTime / 60);
        const seconds = countdownTime % 60;
        const timeFormatted = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        document.getElementById('time').textContent = timeFormatted;

        if (countdownTime === 0) {
            clearInterval(timerInterval);
            document.getElementById('countdown').textContent = 'You can now resend the OTP.';
            document.getElementById('verifyBtn').disabled = true;
        } else {
            countdownTime--;
            document.getElementById('verifyBtn').disabled = false;
        }
    }

    const timerInterval = setInterval(updateCountdown, 1000);

    // OTP input focus jump logic
    const otpInputs = document.querySelectorAll('.otp-input');
    otpInputs.forEach((input, index) => {
        input.addEventListener('input', function (e) {
            const value = e.target.value;
            if (value.length === 1 && index < otpInputs.length - 1) {
                otpInputs[index + 1].focus();
            } else if (value.length === 0 && index > 0 && e.inputType === 'deleteContentBackward') {
                otpInputs[index - 1].focus();
            }
        });

        input.addEventListener('keydown', function (e) {
            if (e.key === "Backspace" && !input.value && index > 0) {
                otpInputs[index - 1].focus();
            }
        });
    });
</script>
{% endblock %}
